<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>사물함 예약 시스템</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    /* 우측 상단의 관리자 링크 스타일 */
    #adminLink {
      position: fixed;
      top: 20px;
      right: 20px;
      text-decoration: underline;
      color: #333;
      cursor: pointer;
      font-size: 16px;
    }
    /* 세련된 헤더 박스 스타일 */
    .header-box {
      background: linear-gradient(45deg, #f39c12, #e67e22);
      border-radius: 15px;
      padding: 30px 20px;
      margin-bottom: 20px;
      display: inline-block;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .header-box h1 {
      margin: 0;
      color: white;
      font-family: Georgia, serif;
      font-size: 36px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    .header-box h2 {
      margin: 0;
      color: #fff;
      font-size: 20px;
      font-style: italic;
      margin-top: 10px;
    }
    /* 사물함 그리드 */
    .locker-grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    .locker {
      width: 60px;
      height: 60px;
      border: 2px solid #f39c12;
      background-color: #fff5e0;
      text-align: center;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .locker:hover {
      background-color: #f39c12;
      color: white;
    }
    .reserved {
      background-color: #ff6f61;
      color: white;
      cursor: not-allowed;
    }
    .selected {
      background-color: #f39c12;
      color: white;
    }
    /* 사물함 예약 폼 */
    .reservation-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      z-index: 100;
      width: 250px;
    }
    .reservation-popup input[type="text"],
    .reservation-popup input[type="password"] {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .reservation-popup button {
      padding: 10px 20px;
      background-color: #f39c12;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }
    .reservation-popup button:hover {
      background-color: #e67e22;
    }
    /* 관리자 페이지 (기본 숨김) */
    .admin-container {
      display: none;
      margin-top: 40px;
      text-align: center;
    }
    .admin-container input[type="password"] {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .admin-container button {
      padding: 10px 20px;
      background-color: #e74c3c;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    .admin-container button:hover {
      background-color: #c0392b;
    }
    /* 테이블 스타일 */
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
    }
  </style>
</head>
<body>
  <!-- 우측 상단의 관리자 링크 -->
  <div id="adminLink">관리자</div>

  <!-- 메인 페이지 (사물함 현황) -->
  <div id="mainContent">
    <!-- 세련된 제목 및 부제목 -->
    <div class="header-box">
      <h1>사물함 예약 시스템</h1>
      <br>
      <h1>총학생회 소설</h1>
    </div>
    <!-- 사물함 현황 -->
    <div id="lockerContainer" class="locker-grid"></div>
  </div>

  <!-- 사물함 예약 폼 (팝업창) -->
  <div id="reservationForm" class="reservation-popup">
    <h3>사물함 예약</h3>
    <input type="text" id="studentId" placeholder="학번" required><br>
    <input type="text" id="studentName" placeholder="이름" required><br>
    <input type="password" id="lockerPassword" placeholder="비밀번호" required><br>
    <button onclick="reserveLocker()">예약하기</button>
    <button onclick="closePopup()">취소</button>
  </div>

  <!-- 관리자 페이지 -->
  <div class="admin-container">
    <h3>관리자 페이지</h3>
    <input type="password" id="adminPassword" placeholder="비밀번호"><br>
    <button id="verifyButton" onclick="verifyAdminPassword()">비밀번호 확인</button>
    <br><br>
    <!-- 비밀번호 확인 후 표시될 리셋 버튼 -->
    <button id="resetButton" onclick="resetLockers()" style="display:none;">리셋</button>
    <br><br>
    <!-- 예약 정보 표 (비밀번호 확인 후 표시) -->
    <div id="adminTableContainer" style="display:none;">
      <h4>예약된 사물함 목록</h4>
      <table id="reservationTable">
        <thead>
          <tr>
            <th>사물함 번호</th>
            <th>학번</th>
            <th>이름</th>
          </tr>
        </thead>
        <tbody>
          <!-- 예약된 정보가 여기에 채워집니다. -->
        </tbody>
      </table>
    </div>
    <br>
    <button onclick="exitAdmin()">뒤로가기</button>
  </div>

  <script>
    let lockers = Array(162).fill(null);  // 162개의 사물함 초기화
    let currentLockerIndex = null;
    const adminRealPassword = 'kentech1234';

    // 예약 가능 시간 설정 (연, 월, 일, 시, 분)
    let openTime = new Date(2025, 1, 20, 8, 0);

    function checkAccessTime() {
      let now = new Date();
      return now >= openTime;
    }

    function loadLockers() {
      const savedLockers = JSON.parse(localStorage.getItem('lockers')) || Array(162).fill(null);
      lockers = savedLockers;
      renderLockers();
    }

    function renderLockers() {
      const container = document.getElementById('lockerContainer');
      container.innerHTML = '';
      lockers.forEach((user, index) => {
        const locker = document.createElement('div');
        locker.classList.add('locker');
        if (user) {
          locker.classList.add('reserved');
          locker.textContent = `예약됨`;
        } else {
          locker.textContent = `사물함 ${index + 1}`;
          locker.onclick = () => selectLocker(index);
        }
        container.appendChild(locker);
      });
    }

    function selectLocker(index) {
      if (lockers[index]) {
        alert('이미 예약된 사물함입니다.');
        return;
      }
      currentLockerIndex = index;
      document.getElementById('reservationForm').style.display = 'block';
    }

    function closePopup() {
      document.getElementById('reservationForm').style.display = 'none';
    }

    function reserveLocker() {
      const studentId = document.getElementById('studentId').value;
      const studentName = document.getElementById('studentName').value;
      const lockerPassword = document.getElementById('lockerPassword').value;

      if (!studentId || !studentName || !lockerPassword) {
        alert('모든 정보를 입력해 주세요.');
        return;
      }

      if (lockers[currentLockerIndex]) {
        alert('이미 예약된 사물함입니다.');
        return;
      }

      lockers[currentLockerIndex] = { studentId, studentName, lockerPassword, timestamp: new Date() };
      localStorage.setItem('lockers', JSON.stringify(lockers));
      alert('사물함 예약이 완료되었습니다!');
      renderLockers();
      closePopup();
    }

    // 관리자 비밀번호 확인 함수
    function verifyAdminPassword() {
      const inputPassword = document.getElementById('adminPassword').value;
      if (inputPassword === adminRealPassword) {
        alert('비밀번호가 맞습니다.');
        document.getElementById('resetButton').style.display = 'inline-block';
        document.getElementById('adminTableContainer').style.display = 'block';
        updateAdminTable();
      } else {
        alert('비밀번호가 틀렸습니다.');
        document.getElementById('resetButton').style.display = 'none';
        document.getElementById('adminTableContainer').style.display = 'none';
      }
    }

    // 관리자용 예약 정보 표 업데이트 함수
    function updateAdminTable() {
      const tbody = document.getElementById('reservationTable').getElementsByTagName('tbody')[0];
      tbody.innerHTML = ''; // 이전 내용 초기화
      lockers.forEach((reservation, index) => {
        if (reservation) {
          const row = document.createElement('tr');
          const cellLocker = document.createElement('td');
          cellLocker.textContent = index + 1;
          const cellStudentId = document.createElement('td');
          cellStudentId.textContent = reservation.studentId;
          const cellStudentName = document.createElement('td');
          cellStudentName.textContent = reservation.studentName;
          row.appendChild(cellLocker);
          row.appendChild(cellStudentId);
          row.appendChild(cellStudentName);
          tbody.appendChild(row);
        }
      });
    }

    // 관리자 페이지에서 리셋하기
    function resetLockers() {
      const confirmReset = confirm("정말로 모든 예약 정보를 리셋하시겠습니까?");
      if (!confirmReset) return;
      localStorage.removeItem('lockers');
      alert('예약 상태가 리셋되었습니다.');
      lockers.fill(null);
      renderLockers();
      updateAdminTable();
    }

    function exitAdmin() {
      document.getElementById('mainContent').style.display = 'block';
      document.querySelector('.admin-container').style.display = 'none';
      // 관리자 페이지 재접속 시 초기 상태로 복원
      document.getElementById('adminPassword').value = '';
      document.getElementById('resetButton').style.display = 'none';
      document.getElementById('adminTableContainer').style.display = 'none';
    }

    // 관리자 링크 클릭 시 메인 페이지 숨기고 관리자 페이지 보여주기
    document.getElementById('adminLink').addEventListener('click', function() {
      document.getElementById('mainContent').style.display = 'none';
      document.querySelector('.admin-container').style.display = 'block';
    });

    window.onload = function() {
      if (checkAccessTime()) {
        loadLockers();
      }
    }
  </script>
</body>
</html>
