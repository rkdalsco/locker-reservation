<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사물함 예약 시스템</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .locker-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 10px; justify-content: center; }
        .locker { width: 50px; height: 50px; border: 1px solid #000; text-align: center; cursor: pointer; }
        .reserved { background-color: red; color: white; cursor: not-allowed; }
    </style>
</head>
<body>
    <h2>사물함 예약 시스템</h2>
    <div>
        <input type="text" id="userId" placeholder="아이디 입력">
        <input type="password" id="password" placeholder="비밀번호">
        <button onclick="login()">로그인</button>
    </div>
    <p id="timerMessage" style="color: red;"></p>
    <div id="lockerContainer" class="locker-grid" style="display: none;"></div>

    <div>
        <input type="password" id="resetPassword" placeholder="리셋 비밀번호">
        <button onclick="resetLockers()">리셋</button>
    </div>

    <script>
        // 예약 가능 시간 설정 (연, 월, 일, 시, 분)
        let openTime = new Date(2025, 1, 20, 8, 0); // 설정 가능한 예약 오픈 시간
        
        const lockers = Array(162).fill(null);
        let currentUser = null;

        function checkAccessTime() {
            let now = new Date();
            if (now < openTime) {
                document.getElementById('timerMessage').innerText = `예약은 ${openTime.toLocaleString()} 이후에 가능합니다.`;
                return false;
            }
            document.getElementById('timerMessage').innerText = '';
            return true;
        }

        function login() {
            if (!checkAccessTime()) {
                alert('예약 가능 시간이 아닙니다.');
                return;
            }
            
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;
            if (password !== '1234') {
                alert('비밀번호가 틀렸습니다.');
                return;
            }
            currentUser = userId;
            document.getElementById('lockerContainer').style.display = 'grid';
            loadLockers();
        }

        function loadLockers() {
            // 로컬 스토리지에서 사용자 예약 정보 불러오기
            const savedLockers = JSON.parse(localStorage.getItem('lockers')) || Array(162).fill(null);
            savedLockers.forEach((user, index) => {
                lockers[index] = user;
            });
            renderLockers();
        }

        function renderLockers() {
            const container = document.getElementById('lockerContainer');
            container.innerHTML = '';
            lockers.forEach((user, index) => {
                const locker = document.createElement('div');
                locker.classList.add('locker');
                if (user) {
                    locker.classList.add('reserved');
                    locker.textContent = user;
                } else {
                    locker.textContent = index + 1;
                    locker.onclick = () => reserveLocker(index);
                }
                container.appendChild(locker);
            });
        }

        function reserveLocker(index) {
            if (!currentUser) {
                alert('로그인이 필요합니다.');
                return;
            }
            if (lockers[index]) {
                alert('이미 예약된 사물함입니다.');
                return;
            }
            lockers[index] = currentUser;
            localStorage.setItem('lockers', JSON.stringify(lockers)); // 예약 상태를 로컬 스토리지에 저장
            renderLockers();
        }

        function resetLockers() {
            const resetPassword = document.getElementById('resetPassword').value;
            if (resetPassword === 'kentech1234') {
                localStorage.removeItem('lockers'); // 로컬 스토리지에서 예약 정보 삭제
                alert('예약 상태가 리셋되었습니다.');
                // 모든 사물함 상태 초기화
                lockers.fill(null);
                renderLockers();
            } else {
                alert('비밀번호가 틀렸습니다.');
            }
        }
    </script>
</body>
</html>
